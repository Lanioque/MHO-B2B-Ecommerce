<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MHO B2B E-commerce Platform - Documentation</title>
    
    <!-- GitHub Markdown CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    
    <!-- Mermaid.js -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    
    <!-- Marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11/marked.min.js"></script>
    
    <!-- panzoom for zoom and pan functionality -->
    <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    
    <style>
        body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 45px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background-color: #ffffff;
        }
        
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
        }
        
        @media (max-width: 767px) {
            .markdown-body {
                padding: 15px;
            }
        }
        
        /* Mermaid diagram styling */
        .mermaid {
            text-align: center;
            margin: 2rem 0;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e1e4e8;
            overflow: hidden;
            position: relative;
        }
        
        /* Mermaid container wrapper for zoom/pan */
        .mermaid-container {
            position: relative;
            margin: 2rem 0;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            background: white;
            overflow: hidden;
        }
        
        .mermaid-wrapper {
            position: relative;
            width: 100%;
            height: auto;
            min-height: 400px;
            overflow: hidden;
            cursor: grab;
        }
        
        .mermaid-wrapper:active {
            cursor: grabbing;
        }
        
        .mermaid-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 5px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .mermaid-controls button {
            background: #fff;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            transition: background-color 0.2s;
        }
        
        .mermaid-controls button:hover {
            background: #f3f4f6;
        }
        
        .mermaid-controls button:active {
            background: #e5e7eb;
        }
        
        .mermaid-title {
            padding: 12px 16px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Loading spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            font-size: 18px;
            color: #586069;
        }
        
        /* Code block styling improvements */
        .markdown-body pre code {
            font-size: 14px;
            line-height: 1.45;
        }
        
        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Error styling */
        .error {
            color: #d73a49;
            padding: 20px;
            border: 1px solid #d73a49;
            border-radius: 6px;
            background-color: #ffeef0;
        }
    </style>
</head>
<body>
    <div class="markdown-body">
        <div id="content" class="loading">Loading documentation...</div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: false, // We'll manually trigger rendering
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 10
            }
        });

        // Function to process Mermaid code blocks
        function processMermaidCode(markdown) {
            let diagramIndex = 0;
            // Replace mermaid code blocks with div tags that Mermaid can process
            // Match ```mermaid followed by any whitespace/newlines, then content, then closing ```
            // Use more flexible regex to handle various formatting
            return markdown.replace(/```\s*mermaid\s*\n([\s\S]*?)\n\s*```/g, function(match, code) {
                diagramIndex++;
                const id = 'mermaid-diagram-' + diagramIndex;
                // Clean up the code - remove extra whitespace but preserve structure
                const cleanedCode = code.trim().replace(/^\s+/gm, ''); // Remove leading whitespace from each line
                console.log(`Processing Mermaid diagram ${diagramIndex}, code length: ${cleanedCode.length}`);
                return `\n<div class="mermaid" id="${id}">${cleanedCode}</div>\n`;
            });
        }

        // Get repository information from current URL
        function getRepoInfo() {
            const pathParts = window.location.pathname.split('/').filter(p => p);
            const hostname = window.location.hostname;
            
            // GitHub Pages format: username.github.io/repo-name/
            // Example: lanioque.github.io/MHO-B2B-Ecommerce/
            // The hostname contains: lanioque.github.io
            // The path contains: MHO-B2B-Ecommerce (or empty if at root)
            
            if (hostname.includes('github.io')) {
                // Extract username from hostname: username.github.io -> username
                const user = hostname.split('.')[0];
                
                // Extract repo from path
                // For /MHO-B2B-Ecommerce/ pathParts = ['MHO-B2B-Ecommerce']
                // For root / pathParts = []
                const repo = pathParts[0] || 'MHO-B2B-Ecommerce';
                
                console.log('Detected repo info:', { user, repo, hostname, pathParts });
                
                return {
                    user: user,
                    repo: repo,
                    isGitHubPages: true
                };
            }
            
            return null;
        }

        // Try multiple methods to load README
        async function loadREADME() {
            const repoInfo = getRepoInfo();
            
            // Build comprehensive list of URLs to try
            const urlsToTry = [];
            
            // Try with detected repo info
            if (repoInfo && repoInfo.isGitHubPages) {
                urlsToTry.push(
                    `https://raw.githubusercontent.com/${repoInfo.user}/${repoInfo.repo}/master/README.md`,
                    `https://raw.githubusercontent.com/${repoInfo.user}/${repoInfo.repo}/main/README.md`
                );
            }
            
            // Try known repository names with both branch names
            const knownRepos = [
                'MHO-B2B-Ecommerce',
                'MHO'
            ];
            
            const branches = ['master', 'main'];
            
            for (const repo of knownRepos) {
                for (const branch of branches) {
                    urlsToTry.push(`https://raw.githubusercontent.com/Lanioque/${repo}/${branch}/README.md`);
                }
            }
            
            // Try relative paths
            urlsToTry.push(
                '../README.md',
                '../../README.md',
                '../../../README.md'
            );

            // Try each URL
            for (const url of urlsToTry) {
                try {
                    console.log(`Trying to load from: ${url}`);
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/plain, text/markdown, */*'
                        }
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        // Verify it's a valid README (contains markdown headers or project name)
                        if (text && text.length > 100 && (text.includes('#') || text.includes('MHO') || text.includes('B2B'))) {
                            console.log(`Successfully loaded from: ${url}`);
                            return text;
                        }
                    }
                } catch (error) {
                    console.log(`Failed to load from ${url}:`, error.message);
                    continue;
                }
            }
            
            throw new Error('Could not load README from any source. Check console for attempted URLs.');
        }

        // Render documentation with timeout
        Promise.race([
            loadREADME(),
            new Promise((_, reject) => 
                setTimeout(() => reject(new Error('Request timeout after 10 seconds')), 10000)
            )
        ])
            .then(text => {
                // Extract Mermaid blocks BEFORE markdown processing
                const mermaidBlocks = [];
                let mermaidIndex = 0;
                
                // Replace mermaid code blocks with placeholders and store the actual code
                const textWithoutMermaid = text.replace(/```\s*mermaid\s*\n([\s\S]*?)\n\s*```/g, (match, code) => {
                    const placeholder = `\n\n<!-- MERMAID_BLOCK_${mermaidIndex} -->\n\n`;
                    mermaidBlocks.push({
                        index: mermaidIndex,
                        code: code.trim()
                    });
                    mermaidIndex++;
                    return placeholder;
                });
                
                // Parse markdown on text without Mermaid blocks
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    headerIds: true,
                    mangle: false
                });
                
                let html = marked.parse(textWithoutMermaid);
                
                // Replace placeholders with Mermaid containers with controls
                mermaidBlocks.forEach((block) => {
                    const placeholder = `<!-- MERMAID_BLOCK_${block.index} -->`;
                    const diagramId = `mermaid-diagram-${block.index + 1}`;
                    const wrapperId = `mermaid-wrapper-${block.index + 1}`;
                    
                    // Create interactive Mermaid container with controls
                    const mermaidContainer = `
                        <div class="mermaid-container">
                            <div class="mermaid-title">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 2a15 15 0 0 0 0 20 15 15 0 0 1 0-20"></path>
                                </svg>
                                Mermaid Diagram ${block.index + 1}
                            </div>
                            <div class="mermaid-wrapper" id="${wrapperId}">
                                <div class="mermaid" id="${diagramId}">${block.code}</div>
                            </div>
                            <div class="mermaid-controls">
                                <button onclick="zoomIn('${wrapperId}')" title="Zoom In">+</button>
                                <button onclick="zoomOut('${wrapperId}')" title="Zoom Out">-</button>
                                <button onclick="resetView('${wrapperId}')" title="Reset View">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                        <path d="M21 3v5h-5"></path>
                                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        <path d="M8 16H3v5"></path>
                                    </svg>
                                </button>
                                <button onclick="fitToScreen('${wrapperId}')" title="Fit to Screen">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                    html = html.replace(placeholder, mermaidContainer);
                });
                
                document.getElementById('content').innerHTML = html;
                
                // Store panzoom instances
                window.mermaidPanzooms = {};
                
                // Render Mermaid diagrams after content is loaded
                setTimeout(() => {
                    const mermaidElements = document.querySelectorAll('.mermaid');
                    console.log(`Found ${mermaidElements.length} Mermaid diagrams to render`);
                    
                    mermaid.run({
                        querySelector: '.mermaid',
                        suppressErrors: false
                    }).then(() => {
                        // Initialize panzoom for each Mermaid diagram after rendering
                        setTimeout(() => {
                            mermaidBlocks.forEach((block) => {
                                const wrapperId = `mermaid-wrapper-${block.index + 1}`;
                                const wrapper = document.getElementById(wrapperId);
                                if (wrapper) {
                                    // Find the SVG element inside the wrapper
                                    const svg = wrapper.querySelector('svg');
                                    if (svg) {
                                        // Initialize panzoom
                                        const panzoom = Panzoom(svg, {
                                            maxScale: 5,
                                            minScale: 0.5,
                                            step: 0.1,
                                            animate: true
                                        });
                                        
                                        // Store instance for controls
                                        window.mermaidPanzooms[wrapperId] = panzoom;
                                        
                                        // Enable pan with mouse drag
                                        wrapper.parentElement.addEventListener('wheel', panzoom.zoomWithWheel);
                                        wrapper.parentElement.addEventListener('wheel', function(e) {
                                            e.preventDefault();
                                            panzoom.zoomWithWheel(e);
                                        });
                                    }
                                }
                            });
                        }, 500);
                    }).catch(err => {
                        console.error('Mermaid rendering error:', err);
                    });
                }, 300);
                
                // Control functions
                window.zoomIn = function(wrapperId) {
                    const panzoom = window.mermaidPanzooms[wrapperId];
                    if (panzoom) {
                        panzoom.zoomIn();
                    }
                };
                
                window.zoomOut = function(wrapperId) {
                    const panzoom = window.mermaidPanzooms[wrapperId];
                    if (panzoom) {
                        panzoom.zoomOut();
                    }
                };
                
                window.resetView = function(wrapperId) {
                    const panzoom = window.mermaidPanzooms[wrapperId];
                    if (panzoom) {
                        panzoom.reset();
                    }
                };
                
                window.fitToScreen = function(wrapperId) {
                    const panzoom = window.mermaidPanzooms[wrapperId];
                    const wrapper = document.getElementById(wrapperId);
                    if (panzoom && wrapper) {
                        const svg = wrapper.querySelector('svg');
                        if (svg) {
                            const bounds = svg.getBBox();
                            const wrapperWidth = wrapper.clientWidth;
                            const wrapperHeight = wrapper.clientHeight;
                            const scale = Math.min(
                                wrapperWidth / bounds.width,
                                wrapperHeight / bounds.height,
                                1
                            );
                            panzoom.setOptions({ minScale: scale * 0.5 });
                            panzoom.reset();
                        }
                    }
                };
            })
            .catch(error => {
                console.error('Error loading README:', error);
                const errorMsg = error.message || 'Unknown error occurred';
                document.getElementById('content').innerHTML = 
                    `<div class="error">
                        <h2>⚠️ Error loading documentation</h2>
                        <p><strong>${errorMsg}</strong></p>
                        <p>Current URL: <code>${window.location.href}</code></p>
                        <p>Path parts: <code>${window.location.pathname.split('/').filter(p => p).join(', ')}</code></p>
                        <p>Please view the README directly on GitHub:</p>
                        <p><a href="https://github.com/Lanioque/MHO-B2B-Ecommerce/blob/master/README.md" target="_blank">
                            View README on GitHub →
                        </a></p>
                        <p>Or try direct link to README:</p>
                        <p><a href="https://raw.githubusercontent.com/Lanioque/MHO-B2B-Ecommerce/master/README.md" target="_blank">
                            View Raw README →
                        </a></p>
                        <p><small>If you're setting up GitHub Pages, make sure:</small></p>
                        <ul>
                            <li><small>README.md exists in the repository root</small></li>
                            <li><small>GitHub Pages is enabled for the repository</small></li>
                            <li><small>Source is set to '/docs' folder</small></li>
                            <li><small>Check browser console (F12) for attempted URLs</small></li>
                        </ul>
                        <p><strong>Manual fix:</strong> If this continues, edit <code>docs/index.html</code> and update the repository name in the knownRepos array.</p>
                    </div>`;
            });
    </script>
</body>
</html>

